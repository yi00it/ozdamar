<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{page_title}}</title>
  <meta name="description" content="{{page_description}}">
  <link rel="stylesheet" href="{{base_path}}/assets/main.css">
  <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="{{base_path}}/feed.xml">
  <script>
    // Prevent flash of incorrect theme
    (function() {
      const theme = localStorage.getItem('theme') || 'dark';
      if (theme === 'light') {
        document.documentElement.classList.add('light-theme');
      }
    })();
  </script>
</head>
<body class="min-h-screen relative screen-flicker">

  <!-- CRT Overlay Lines -->
  <div class="crt-overlay fixed inset-0 z-50 w-full h-full pointer-events-none"></div>

  <!-- Main Container -->
  <div class="max-w-4xl mx-auto p-6 md:p-12 relative z-10">

    <!-- Header Status Bar -->
    <header class="border-b border-green pb-4 mb-12 flex justify-between items-center text-xs md:text-sm tracking-widest uppercase text-dim">
      <div>SYS.STATUS: ONLINE</div>
      <div class="flex items-center gap-4">
        <button id="theme-toggle" class="border border-green px-2 py-1 hover:bg-dim transition-all cursor-pointer" aria-label="Toggle theme">
          <span id="theme-label">[DARK]</span>
        </button>
        <div id="clock">00:00:00</div>
      </div>
    </header>

    <main>
      {{content}}
    </main>

    <!-- Footer -->
    <footer class="border-t border-green pt-6 pb-12 flex justify-between items-end text-xs text-dim mt-24">
      <div class="flex flex-col gap-1">
        <span>TERM_SESSION_ID: 0x4F2A</span>
        <span>Â© {{current_year}} {{site_name}}</span>
      </div>
      <div class="animate-pulse">
        SYSTEM_IDLE
      </div>
    </footer>
  </div>

  <!-- Scripts -->
  <script>
    // Theme Toggle Functionality
    function initTheme() {
      const theme = localStorage.getItem('theme') || 'dark';
      const themeLabel = document.getElementById('theme-label');
      const html = document.documentElement;

      if (theme === 'light') {
        html.classList.add('light-theme');
        if (themeLabel) themeLabel.textContent = '[LIGHT]';
      } else {
        html.classList.remove('light-theme');
        if (themeLabel) themeLabel.textContent = '[DARK]';
      }
    }

    function toggleTheme() {
      const html = document.documentElement;
      const themeLabel = document.getElementById('theme-label');
      const isLight = html.classList.contains('light-theme');

      if (isLight) {
        html.classList.remove('light-theme');
        localStorage.setItem('theme', 'dark');
        if (themeLabel) themeLabel.textContent = '[DARK]';
      } else {
        html.classList.add('light-theme');
        localStorage.setItem('theme', 'light');
        if (themeLabel) themeLabel.textContent = '[LIGHT]';
      }
    }

    // Initialize theme on page load
    initTheme();

    // Attach event listener to toggle button
    const toggleButton = document.getElementById('theme-toggle');
    if (toggleButton) {
      toggleButton.addEventListener('click', toggleTheme);
    }

    // Clock Functionality
    function updateClock() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('en-US', { hour12: false });
      const clockEl = document.getElementById('clock');
      if (clockEl) clockEl.textContent = timeString;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Section Reveal on Scroll
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.remove('opacity-0');
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.fade-reveal').forEach(el => {
      observer.observe(el);
    });
  </script>
</body>
</html>
